<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.1.7//EN"
    "http://struts.apache.org/dtds/struts-2.1.7.dtd">

<struts>
	
	<constant name="struts.objectFactory" value="spring"/>
	
	<!-- 
		1. 如果 namespace 不一樣，package name 一樣，則 initial 的時候就會出現錯誤，所以表示不同的 namespace 會對應到不同的 package name
	    2. action class=".." 的部份需要對應到src底下的java檔  method=".." 則是java檔裡的函式名稱
		3. 如果今天的路徑是 : http://localhost:4321/WebProject/angus/index.jsp
			- WebProject 就是專案的名稱
			- angus 就是 namespace
			- 假如 /angus/index.jsp 中有個呼叫 action 的動作，因為現在 namespace 是在 /angus 下，
			        所以在找對應的 action 時，就會從 package 中 namespace 叫做 /angus 的範圍底下先找
		4. struts package 裡的元素必須按照一定的順序排列，這個順序是:
			-result-types
			-interceptors
			-default-interceptor-ref
			-default-action-ref
			-default-class-ref
			-global-results
			-global-exception-mappings
			-action*(就是所有的action放到最後)
	 -->
	
	<package name="default" extends="struts-default" namespace="">
		
		<!-- 整合 Jasper Report 所新增的 Result Type-->
		<result-types>
        	<result-type name="jasper" class="org.apache.struts2.views.jasperreports.JasperReportsResult" />
        	<result-type name="json"   class="org.apache.struts2.json.JSONResult"/>
    	</result-types>
		
		<interceptors>
		
			<interceptor name="json"   class="org.apache.struts2.json.JSONInterceptor"/>
			<interceptor name="loginintercetor" class="web.struts.Interceptor.LoginInterceptor" />
			
			<interceptor-stack name="myStack">
				<interceptor-ref name="json"/>
				<interceptor-ref name="loginintercetor" />
				<interceptor-ref name="defaultStack" />
			</interceptor-stack>
			
		</interceptors>
		
		<default-interceptor-ref name="myStack" />
		
		
		<!-- default-action-ref 它的意思是說，如果你指定的Action沒有找到，則轉而調用該標籤定義的action，在這個例子里，就是test.action，這個標籤跟 redirect 沒有關係   -->
		<!-- <default-action-ref name="test" /> 影響 debug 的直覺，先 mark-->
		
		<!-- 定義在<action>元素裡面的<result>可以稱之為局部<result>，除此之外我們還可以定義全域<result>，全域<result>會被多個<action>所共享 -->
		<global-results>
			<result name="index">index.jsp</result>
		</global-results>
		
		<action name="test"> 
			<result type="redirectAction">
            	<param name="namespace">/</param>
            	<param name="actionName">index</param>
        	</result>
		</action>
		
		<action name="index" class="web.struts.IndexAction" method="index"> 
			<result name="success">index.jsp</result>
		</action>
		
		<action name="middleware" class="web.struts.MiddlewareAction" method="index">
			<result name="success" type="redirectAction">
				<param name="actionName">transfer</param>
				<param name="value1">${value1}</param>
            	<param name="value2">${value2}</param>
			</result>
		</action>
		
		<action name="transfer" class="web.struts.TransferAction" method="index">
			<result name="success">transfer.jsp</result>
		</action>
		
		<action name="login" class="web.struts.spring.LoginAction" method="execute">
            <result name="success">/login/welcome.jsp</result>
            <result name="error">/login/error.jsp</result>
        </action>
		
		<action name="HelloLocale">
    		<result>/locale/HelloLocale.jsp</result>
		</action>
		
		<!-- 有個現象是如果 namespace="" result 導向的頁面是 /sitemesh 開頭， 
		那麼在網誌列打 http://localhost:8080/WebProject/HelloSiteMesh.action 會沒辦法套用到連結的 css 檔案
		但是打 http://localhost:8080/WebProject/sitemesh/HelloSiteMesh.action 就可以套用到，這是否意味著
		要養成如果 result 頁面是 /sitemesh 開頭，就獨立開一個 namespace 是 /sitemesh 的 package 比較好
		-->
		<action name="HelloSiteMesh">
    		<result>/sitemesh/HelloSiteMesh.jsp</result>
		</action>
		
		<action name="HelloJasper" class="web.struts.jasperreport.HelloJasper" method="execute">
            <result name="success" type="jasper">
                <param name="location">/reporting/jasper/test.jasper</param>
                <param name="dataSource">queryList</param>
                <param name="reportParameters">paramMap</param>
                
                <param name="format">XLS</param> <!-- format 輸出類型，預設是PDF，其他還有：XML、HTML、XLS、CSV、RTF ，注意這裡一定要大寫 -->
                <param name="contentDisposition">filename="test.xls"</param>
                
                <!--
                <param name="format">PDF</param>
                <param name="contentType">application/pdf</param>
                <param name="contentDisposition">attachment;filename="test.pdf"</param>
                -->
            </result>
        </action>
		
		<action name="query" class="web.struts.jasperreport.HelloJasper" method="execute"> 
			<result name="success">index.jsp</result>
		</action>
		
		<action name="excel" class="web.struts.jasperreport.HelloJasper" method="execute">
			<result name="success" type="jasper">
				<param name="location">/reporting/jasper/test.jasper</param>
            	<param name="dataSource">queryList</param>
            	<param name="reportParameters">paramMap</param>
            	<param name="format">XLS</param> <!-- format 輸出類型，預設是PDF，其他還有：XML、HTML、XLS、CSV、RTF ，注意這裡一定要大寫 -->
            	<param name="contentDisposition">filename="test.xls"</param>
            </result>
		</action>
		
		<action name="pdf" class="web.struts.jasperreport.HelloJasper" method="execute">
			<result name="success" type="jasper"> 
				<param name="location">/reporting/jasper/test.jasper</param>
            	<param name="dataSource">queryList</param>
            	<param name="reportParameters">paramMap</param>
            	<param name="format">PDF</param>
            	<param name="contentType">application/pdf</param>
            	<param name="contentDisposition">attachment;filename="test.pdf"</param>
            </result>
		</action>
		
		<action name="chart" class="web.struts.chartdirector.HelloChartDirector" method="execute">
			<result name="success">index.jsp</result>
		</action>
		
	</package>
	
	<package name="angus" extends="struts-default" namespace="/angus">
		<action name="index" class="web.struts.IndexAction" method="index">
			<result name="success">index.jsp</result>
			<!-- 也可以使用下面的寫法，開頭有 / 就表示是絕對路徑，上面的寫法是相對路徑，表示 index.jsp 在 angus 資料夾中 -->
			<!-- <result name="success">/angus/index.jsp</result> -->
		</action>
	</package>
	
</struts>